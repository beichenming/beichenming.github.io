I"L<p><code class="highlighter-rouge">åŸåˆ›æ–‡ç« è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢</code></p>

<hr />

<p><strong>æœ€è¿‘åœ¨é¡¹ç›®ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘ä¸­å­˜åœ¨4ç§Purpose Typeï¼Œæ¯ç§Purpose Typeåˆæœ‰5ç§Status typeï¼Œæ‰€ä»¥å°±æœ‰20ç§ç»„åˆï¼Œæ¯ç§ç»„åˆå‡ºæ¥çš„typeéƒ½ä¼šå¯¹åº”ä¸€ä¸ªstringï¼Œè€Œä¸”æœªæ¥typeçš„æ•°é‡å¯èƒ½ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ‰€ä»¥è¿™ä¸ªå¦‚æœç”¨switchï¼Œifç­‰æ¥æ“ä½œåˆ¤æ–­å¯¹åº”çš„å­—ç¬¦ä¸²æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼Œå¤ªå†—ä½™ä¸åˆ©äºæ‰©å±•ï¼Œé‡‡ç”¨æ•°æ®å­—å…¸çš„æ–¹å¼ä¹Ÿä¸å¤ªå¥½è¿˜éœ€è¦è‡ªå·±æ‰‹åŠ¨å»ºï¼Œæ¯æ¬¡æ›´æ–°ä¹Ÿè¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ä¸¤ä¸ªtypeå°±ç»„åˆå‡ºå¯¹åº”çš„stringï¼Œä½†æ˜¯OCä¸­åå°„åªæ˜¯é’ˆå¯¹äºClassï¼Œå¯¹äºåŸºç¡€ç±»å‹çš„æ“ä½œæˆ‘ä»¬åªèƒ½ä¾èµ–äºC++æ¥å¸®æˆ‘ä»¬å®Œæˆã€‚</strong></p>

<p><code class="highlighter-rouge">å¦‚ä¸‹æœ‰è¿™ä¸¤ä¸ªenumï¼Œå¯ä»¥ç»„åˆæˆ20ç§typeçš„string</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>typedef NS_ENUM(NSUInteger, BMTAccountType) {
  kBMTAccountTypeUnknow = 0,
  kBMTAccountTypeConception = 1,
  kBMTAccountTypeContraception = 2,
  kBMTAccountTypeMenstruation = 4,
  kBMTAccountTypePregnancyMonitor = 8,
};


typedef NS_ENUM(NSInteger, BMTMenstruationPeriodStatusType) {
  kReportCalendarDayTypeUnknown = -1,
  kReportCalendarDayTypeNormal,    
  kReportCalendarDayTypeMenustration,
  kReportCalendarDayTypeOvulation,
  kReportCalendarDayTypeCalculateMenstruation,
  kReportCalendarDayTypeOvulationDays
};

</code></pre></div></div>
<p><code class="highlighter-rouge">æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯ä»¥è‡ªåŠ¨ç»„åˆæˆä»¥ä¸‹çš„æ–¹å¼ç›´æ¥è°ƒç”¨ï¼ˆå‘½åä¸æ˜¯å¾ˆä¼˜é›…ï¼‰ã€‚</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hint.kBMTAccountTypeConception.kReportCalendarDayTypeNormal.Title = "XXX";
Hint.kBMTAccountTypeConception.kReportCalendarDayTypeOvulation.Title = "XXX";
Hint.kBMTAccountTypeConception.kReportCalendarDayTypeMenustration.Title = "XXX";
Hint.kBMTAccountTypeConception.kReportCalendarDayTypeOvulationDays.Title = "XXX";

Hint.kBMTAccountTypeContraception.kReportCalendarDayTypeNormal.Title = "XXX";
Hint.kBMTAccountTypeContraception.kReportCalendarDayTypeOvulation.Title = "XXX";
Hint.kBMTAccountTypeContraception.kReportCalendarDayTypeMenustration.Title = "XXX";
Hint.kBMTAccountTypeContraception.kReportCalendarDayTypeOvulationDays.Title = "XXX";

Hint.kBMTAccountTypeMenstruation.kReportCalendarDayTypeNormal.Title = "XXX";
Hint.kBMTAccountTypeMenstruation.kReportCalendarDayTypeOvulation.Title = "XXX";
Hint.kBMTAccountTypeMenstruation.kReportCalendarDayTypeMenustration.Title = "XXX";
Hint.kBMTAccountTypeMenstruation.kReportCalendarDayTypeOvulationDays.Title = "XXX";

Hint.kBMTAccountTypePregnancyMonitor.kReportCalendarDayTypeNormal.Title = "XXX";
Hint.kBMTAccountTypePregnancyMonitor.kReportCalendarDayTypeOvulation.Title = "XXX";
Hint.kBMTAccountTypePregnancyMonitor.kReportCalendarDayTypeMenustration.Title = "XXX";
Hint.kBMTAccountTypePregnancyMonitor.kReportCalendarDayTypeOvulationDays.Title = "XXX";
</code></pre></div></div>
<p><code class="highlighter-rouge">æˆ‘ä»¬çš„åŸºæœ¬æ€è·¯æ˜¯è‡ªå®šä¹‰NS_ENUMï¼Œç„¶åä½¿ç”¨__VA_ARGS__è¿›è¡Œå­—ç¬¦ä¸²è§£æï¼Œå»é™¤ç©ºæ ¼å’Œç­‰å·ï¼Œæœ€ååå°„å‡ºç»“æœ,å¦‚ä¸‹ï¼š</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ifndef BMT_REFLECT_ENUM_H
#define BMT_REFLECT_ENUM_H

NSString *reflectString(NSString *enumDefinition, NSNumber *number);

__attribute__((overloadable)) NSString *BMTReflectStringForMember(NSInteger value);

#define BMT_REFLECTABLE_ENUM(type, name, ...) \
typedef NS_ENUM(type, name) { \
__VA_ARGS__ \
}; \
\
__attribute__((overloadable)) static inline NSString *BMTReflectStringForMember(name value) { \
  return reflectString(@(#__VA_ARGS__), @(value)); \
} \


#endif

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (NSArray *)makeArray:(id(^)(id obj))block {
  NSMutableArray *array = [NSMutableArray arrayWithCapacity:[self count]];
  for(id obj in self) {
    [array addObject:block(obj)];
  }
  return array;
}

- (void)setupWithEnumDefinition:(NSString *)enumDefinition {
  NSNumberFormatter *numberFormatter = [NSNumberFormatter new];
  numberFormatter.numberStyle = NSNumberFormatterDecimalStyle;
  
  NSInteger currentIndex = -1;
  NSMutableDictionary *mutableDictionary = [NSMutableDictionary new];
  
  for (NSString *member in [enumDefinition componentsSeparatedByString:@","]) {
    NSArray *parts = [[member componentsSeparatedByString:@"="] makeArray:^NSString *(NSString *element) {
      return [element stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]];
    }];
    
    NSAssert(parts.count == 1 || parts.count == 2, @"Reflect Enum illegal member definition");
    
    NSString *name = [parts firstObject];
    if (parts.count == 2) {
      NSString *valueString = [parts lastObject];
      NSNumber *number = [numberFormatter numberFromString:valueString];
      
      if (!number) {
        NSAssert(NO, @"Reflect Enum get string for the enum with duplicated values");
      } else {
        NSString *matchingObject = [mutableDictionary objectForKey:number];
        if (matchingObject) {
          NSAssert(NO, @"Reflect Enum get string for the enum with duplicated values");
        }
      }
      
      currentIndex = [number longLongValue];
    } else {
      currentIndex++;
    }
    mutableDictionary[@(currentIndex)] = name;
  }
  
  _mapFromValueToString = [mutableDictionary copy];
}
</code></pre></div></div>

<p><code class="highlighter-rouge">è¿™é‡Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„ç‚¹ï¼š</code></p>

<p><code class="highlighter-rouge">* æˆ‘ä»¬éœ€è¦ç¼“å­˜æ¯ä¸ªæšä¸¾è§£æåçš„å€¼ï¼Œé˜²æ­¢æµªè´¹èµ„æº</code></p>

<p><code class="highlighter-rouge">* æˆ‘ä»¬çš„åå°„æšä¸¾ç±»å‹ä¸­ä¸èƒ½åŒ…æ‹¬ç›¸åŒçš„æšä¸¾å€¼ï¼Œkey-valueæ˜¯å”¯ä¸€å¯¹åº”çš„</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Demo one
REFLECTABLE_ENUM(NSInteger,
   ThirdEnum,
   ThirdEnum1 = 0,
   ThirdEnum2 = ThirdEnum1,
   ThirdEnum3,
   ThirdEnum4
);

// Demo two
REFLECTABLE_ENUM(NSInteger,
   ThirdEnum,
   ThirdEnum1 = 0,
   ThirdEnum2 = 0,
   ThirdEnum3,
   ThirdEnum4
);
</code></pre></div></div>

<p><strong>githubä¸Šæœ‰ä¸€ä¸ªé¡¹ç›®å°±æ˜¯åšäº†<a href="https://github.com/fastred/ReflectableEnum">è¿™ä»¶äº‹</a>ï¼Œä¸è¿‡ç”±äºè¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰å¿…è¦å»ä¾èµ–è¿™ä¸ªåº“ï¼Œè‡ªå·±å†™åè€Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œè€Œä¸”è¿™ä¸ªé¡¹ç›®æœ‰ä¸€ä¸ªå°bugã€‚å°±æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œä¸ºäº†ä¿æŒkey-valueçš„å”¯ä¸€å¯¹åº”ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†ä¸Šé¢çš„ä¸¤ç§æƒ…å†µï¼Œä½†æ˜¯é¡¹ç›®é‡Œä»…å¤„ç†äº†ç¬¬ä¸€ç§æƒ…å†µï¼Œä½†ç¬¬äºŒç§æƒ…å†µå…¶å®ä¹Ÿæ˜¯éœ€è¦å¤„ç†çš„ã€‚</strong></p>

<h4 id="æˆ‘æäº¤çš„ä»£ç é€šè¿‡å®¡æ ¸bugfixäº†">æˆ‘æäº¤çš„ä»£ç é€šè¿‡å®¡æ ¸BugFixäº†ã€‚</h4>

<p><img src="../../../../img/technology/2016-06-12/pic_one.jpg" alt="4.pic.jpg" /></p>

:ET